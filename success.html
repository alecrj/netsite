<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResellAI - Connecting to eBay...</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .container {
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .logo {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #39FF14;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #39FF14;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .message {
            font-size: 1.1rem;
            margin: 20px 0;
        }
        .fallback {
            margin-top: 30px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 0.9rem;
        }
        .fallback a {
            color: #39FF14;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">ResellAI</div>
        <div class="spinner"></div>
        <div class="message" id="message">
            Connecting your eBay account...
        </div>
        <div class="fallback" id="fallback" style="display: none;">
            <p>Having trouble? <a href="#" onclick="openApp()">Tap here to open ResellAI</a></p>
        </div>
    </div>

    <script>
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const result = {};
            for (const [key, value] of params) {
                result[key] = value;
            }
            return result;
        }

        function openApp() {
            const params = getUrlParams();
            
            // Build the deep link to your app
            let appURL = 'resellai://auth/ebay';
            
            // Add all URL parameters to the app redirect
            const paramString = new URLSearchParams(params).toString();
            if (paramString) {
                appURL += '?' + paramString;
            }
            
            console.log('Redirecting to app:', appURL);
            
            // Try to open the app
            window.location.href = appURL;
            
            // Show fallback after a delay
            setTimeout(() => {
                document.getElementById('fallback').style.display = 'block';
                document.getElementById('message').textContent = 'Please open the ResellAI app to complete the connection.';
            }, 2000);
        }

        function handleEbayCallback() {
            const params = getUrlParams();
            
            if (params.code) {
                // Success - got authorization code
                document.getElementById('message').textContent = 'eBay connected successfully! Opening ResellAI...';
                setTimeout(openApp, 1000);
            } else if (params.error) {
                // Error occurred
                document.getElementById('message').textContent = 'Connection failed. Please try again.';
                document.getElementById('fallback').style.display = 'block';
                
                // Still try to open app with error info
                setTimeout(openApp, 2000);
            } else {
                // No params - probably direct access
                document.getElementById('message').textContent = 'Please use the ResellAI app to connect your eBay account.';
                document.getElementById('fallback').style.display = 'block';
            }
        }

        // Run when page loads
        window.onload = handleEbayCallback;
        
        // Also try to open app immediately if we have an auth code
        const params = getUrlParams();
        if (params.code) {
            setTimeout(openApp, 500);
        }
    </script>
</body>
</html>